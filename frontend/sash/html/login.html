<script>
  const token = localStorage.getItem("token");
  if (token) {
    window.location.href = "/frontend/sash/html/index.html"; // Redirige vers login
  }
</script>

<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <!-- META DATA -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="description"
      content="Sash – Bootstrap 5  Admin & Dashboard Template"
    />
    <meta name="author" content="Spruko Technologies Private Limited" />
    <meta
      name="keywords"
      content="admin,admin dashboard,admin panel,admin template,bootstrap,clean,dashboard,flat,jquery,modern,responsive,premium admin templates,responsive admin,ui,ui kit."
    />

    <!-- FAVICON -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="../assets/images/brand/favicon.ico"
    />

    <!-- TITLE -->
    <title>Sash – Bootstrap 5 Admin & Dashboard Template</title>

    <!-- BOOTSTRAP CSS -->
    <link
      id="style"
      href="../assets/plugins/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- STYLE CSS -->
    <link href="../assets/css/style.css" rel="stylesheet" />

    <!-- Plugins CSS -->
    <link href="../assets/css/plugins.css" rel="stylesheet" />

    <!--- FONT-ICONS CSS -->
    <link href="../assets/css/icons.css" rel="stylesheet" />

    <!-- INTERNAL Switcher css -->
    <link href="../assets/switcher/css/switcher.css" rel="stylesheet" />
    <link href="../assets/switcher/demo.css" rel="stylesheet" />
  </head>

  <body class="app sidebar-mini ltr login-img">
    <!-- BACKGROUND-IMAGE -->
    <div class="">
      <!-- GLOABAL LOADER -->
      <div id="global-loader">
        <img
          src="../assets/images/loader.svg"
          class="loader-img"
          alt="Loader"
        />
      </div>
      <!-- /GLOABAL LOADER -->

      <!-- PAGE -->
      <div class="page">
        <div class="">
          <!-- Theme-Layout -->

          <!-- CONTAINER OPEN -->
          <div class="col col-login mx-auto mt-7">
            <div class="text-center">
              <a href="index.html"
                ><img
                  src="../assets/images/brand/logo-white.png"
                  class="header-brand-img"
                  alt=""
              /></a>
            </div>
          </div>

          <div class="container-login100">
            <div class="wrap-login100 p-6">
              <form class="login100-form validate-form" id="loginForm">
                <span class="login100-form-title pb-5"> Connexion </span>
                <div class="panel panel-primary">
                  <div class="tab-menu-heading">
                    <p id="message"></p>
                  </div>
                  <div class="panel-body tabs-menu-body p-0 pt-5">
                    <div class="tab-content">
                      <div class="tab-pane active" id="tab5">
                        <div
                          class="wrap-input100 validate-input input-group"
                          data-bs-validate="Valid email is required: ex@abc.xyz"
                        >
                          <a
                            href="javascript:void(0)"
                            class="input-group-text bg-white text-muted"
                          >
                            <i
                              class="zmdi zmdi-email text-muted"
                              aria-hidden="true"
                            ></i>
                          </a>
                          <input
                            class="input100 border-start-0 form-control ms-0"
                            type="email"
                            placeholder="Adresse mail"
                            id="email"
                            name="email"
                          />
                        </div>
                        <div
                          class="wrap-input100 validate-input input-group"
                          id="Password-toggle"
                        >
                          <a
                            href="javascript:void(0)"
                            class="input-group-text bg-white text-muted"
                          >
                            <i
                              class="zmdi zmdi-eye text-muted"
                              aria-hidden="true"
                            ></i>
                          </a>
                          <input
                            class="input100 border-start-0 form-control ms-0"
                            type="password"
                            placeholder="mot de passe"
                            id="motDePasse"
                            name="motDePasse"
                          />
                        </div>
                        <div class="text-end pt-4">
                          <p class="mb-0">
                            <a
                              href="forgot-password.html"
                              class="text-primary ms-1"
                              >Mot de passe oublié?</a
                            >
                          </p>
                        </div>
                        <div class="container-login100-form-btn">
                          <button
                            type="submit"
                            class="login100-form-btn btn-primary"
                          >
                            Se connecter
                          </button>
                        </div>
                        <div class="text-center pt-3">
                          <p class="text-dark mb-0">
                            Vous n'avez pas de compte?<a
                              href="inscription_etudiant.html"
                              class="text-primary ms-1"
                              >S'inscrire</a
                            >
                          </p>
                        </div>
                      </div>
                      <div class="tab-pane" id="tab6">
                        <div
                          id="mobile-num"
                          class="wrap-input100 validate-input input-group mb-4"
                        >
                          <a
                            href="javascript:void(0)"
                            class="input-group-text bg-white text-muted"
                          >
                            <span>+91</span>
                          </a>
                          <input
                            class="input100 border-start-0 form-control ms-0"
                          />
                        </div>
                        <div id="login-otp" class="justify-content-around mb-5">
                          <input
                            class="form-control text-center w-15"
                            id="txt1"
                            maxlength="1"
                          />
                          <input
                            class="form-control text-center w-15"
                            id="txt2"
                            maxlength="1"
                          />
                          <input
                            class="form-control text-center w-15"
                            id="txt3"
                            maxlength="1"
                          />
                          <input
                            class="form-control text-center w-15"
                            id="txt4"
                            maxlength="1"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <!-- CONTAINER CLOSED -->
        </div>
      </div>
      <!-- End PAGE -->
    </div>
    <!-- BACKGROUND-IMAGE CLOSED -->

    <!-- JQUERY JS -->
    <script src="../assets/js/jquery.min.js"></script>

    <!-- BOOTSTRAP JS -->
    <script src="../assets/plugins/bootstrap/js/popper.min.js"></script>
    <script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>

    <!-- SHOW PASSWORD JS -->
    <script src="../assets/js/show-password.min.js"></script>

    <!-- GENERATE OTP JS -->
    <script src="../assets/js/generate-otp.js"></script>

    <!-- Perfect SCROLLBAR JS-->
    <script src="../assets/plugins/p-scroll/perfect-scrollbar.js"></script>

    <!-- Color Theme js -->
    <script src="../assets/js/themeColors.js"></script>

    <!-- CUSTOM JS -->
    <script src="../assets/js/custom.js"></script>

    <!-- Custom-switcher -->
    <script src="../assets/js/custom-swicher.js"></script>

    <!-- Switcher js -->
    <script src="../assets/switcher/js/switcher.js"></script>
    <script>
      const backendUrl = "http://localhost:5001"; // Mets ici l'URL de ton backend  /api/utilisateurs/connexion

      $(document).ready(function () {
        $("#loginForm").submit(function (e) {
          e.preventDefault();

          const email = $("#email").val();
          const motDePasse = $("#motDePasse").val();

          console.log(email, motDePasse);

          $.ajax({
            url: backendUrl + "/api/utilisateurs/connexion",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({ email, motDePasse }),
            success: function (response) {
              const utilisateur = response.data;
              console.log(utilisateur);
              localStorage.setItem("role", utilisateur.role);

              // Stocker le token
              localStorage.setItem("token", response.token);
              // Rediriger vers le dashboard
              //show a alert to the user

              // Redirection vers le bon dashboard
              if (utilisateur.role === "etudiant") {
                window.location.href = "/frontend/sash/html/espace_etudiant.html";
              } else if (utilisateur.role === "ambassadeur") {
                window.location.href = "/frontend/sash/html/espace_etudiant.html";
              } else if (utilisateur.role === "administrateur") {
                window.location.href = "/frontend/sash/html/espace_admin.html";
              }

              $("#message").text("Connexion réussie");
              $("#message").css("color", "green");
               setTimeout(function () {
                 window.location.href = "/frontend/sash/html/index.html";
               }, 1000);
            },
            error: function (xhr) {
              const message =
                xhr.responseJSON?.message || "Erreur d'authentification";
              $("#message").text(message);
              $("#message").css("color", "red");
            },
          });
        });
      });
    </script>
  </body>
</html>
